name: libffi
version: 3.4.7
release: 1
url: https://github.com/libffi/libffi/releases/download/v3.4.7/libffi-3.4.7.tar.gz
homepage: https://sourceware.org/libffi/
license: MIT
summary: Foreign Function Interface library
description: |
  The libffi library provides a portable, high level programming interface to various calling conventions. This allows a programmer to call any function specified by a call interface description at run time.
phase: 2
order: 2
critical: true
buildsteps: |
  export CC="clang"
  export CXX="clang++"
  export CFLAGS="-std=gnu99 --sysroot=$LFS"
  export LDFLAGS="--sysroot=$LFS -Wl,--dynamic-linker=/lib/ld-musl-x86_64.so.1"
  export PKG_CONFIG_SYSROOT_DIR="$LFS"
  export PKG_CONFIG_PATH="$LFS/usr/lib/pkgconfig:$LFS/usr/share/pkgconfig"  
  
  ./configure --prefix=$LFS/usr  --host=x86_64-linux-musl

  make

  if [ "$RUN_TESTS" = "1" ]; then
      set +e
      make check
      set -e
  fi

  make install
builddeps: []
