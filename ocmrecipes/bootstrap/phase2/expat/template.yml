name: expat
version: 2.7.1
release: 1
# I recognize the warning, but LFS 12.3 uses this version. Once I get the build 
# system working I can upgrade
url: https://sourceforge.net/projects/expat/files/expat/2.7.1/expat-2.7.1.tar.xz
homepage: https://libexpat.github.io/
license: MIT
summary: XML Parsing Library
description: |
  The Expat package contains a stream oriented C library for parsing XML.
phase: 2
order: 22
critical: true
#builddeps: [make, glibc]
buildsteps: |
  export CC="clang"
  export CXX="clang++"
  export CFLAGS="-std=gnu99 --sysroot=$LFS"
  export LDFLAGS="--sysroot=$LFS -Wl,--dynamic-linker=/lib/ld-musl-x86_64.so.1"
  export PKG_CONFIG_SYSROOT_DIR="$LFS"
  export PKG_CONFIG_PATH="$LFS/usr/lib/pkgconfig:$LFS/usr/share/pkgconfig"  

  ./configure --prefix=$LFS/usr    \
              --docdir=$LFS/usr/share/doc/expat-{version} \
              --host=x86_64-pc-linux-musl 
  make

  if [ "$RUN_TESTS" = "1" ]; then
      set +e
      make check
      set -e
  fi

  make install

  install -m644 doc/*.{html,css} $LFS/usr/share/doc/expat-{version}

