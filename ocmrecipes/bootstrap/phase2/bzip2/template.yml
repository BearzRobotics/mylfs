name: bzip2
version: 1.0.8
release: 1
url: https://www.sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz
homepage: https://sourceware.org/bzip2/
license: Modified zlib license
summary: Bzip2 a much better bzip
description: |
  contains programs for compressing and decompressing files. Compressing text files with bzip2 yields a much better compression percentage than with the traditional gzip.
phase: 2
order: 16
critical: true
#builddeps: [make, glibc]
buildsteps: |
  export CC="clang"
  export CXX="clang++"
  export CFLAGS="-std=gnu99 --sysroot=$LFS -I$LFS/usr/include -D_POSIX_C_SOURCE=200809L -D_XOPEN_SOURCE=700 -Wno-error=implicit-function-declaration"
  export LDFLAGS="--sysroot=$LFS -Wl,--dynamic-linker=/lib/ld-musl-x86_64.so.1"
  export PKG_CONFIG_SYSROOT_DIR="$LFS"
  export PKG_CONFIG_PATH="$LFS/usr/lib/pkgconfig:$LFS/usr/share/pkgconfig"  
  
  patch -Np1 -i ../patches/bzip2-1.0.8-install_docs-1.patch

  sed -i 's@\(ln -s -f \)$(PREFIX)/bin/@\1@' Makefile
  sed -i "s@(PREFIX)/man@(PREFIX)/share/man@g" Makefile

  make -f Makefile-libbz2_so
  make clean
  make
  make PREFIX=$LFS/usr install

  cp -a libbz2.so.* $LFS/usr/lib
  ln -vfs libbz2.so.{version} $LFS/usr/lib/libbz2.so
  cp bzip2-shared $LFS/usr/bin/bzip2
  for i in $LFS/usr/bin/{bzcat,bunzip2}; do
    ln -sfv bzip2 $i
  done
  #rm -f $LFS/usr/lib/libbz2.a
builddeps: []
